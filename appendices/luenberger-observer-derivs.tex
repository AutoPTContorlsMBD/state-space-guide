\chapter{Luenberger observer derivations}

\section{Kalman filter as Luenberger observer}
\label{subsec:app-kalman-luenberger}

A Luenberger observer is defined as

\begin{align}
  \hat{\mtx{x}}_{k+1}^+ &= \mtx{A}\hat{\mtx{x}}_k^- + \mtx{B}\mtx{u}_k + \mtx{L}
    (\mtx{y}_k - \hat{\mtx{y}}_k) \label{eq:luenberger1} \\
  \hat{\mtx{y}}_k &= \mtx{C} \hat{\mtx{x}}_k^- \label{eq:luenberger2}
\end{align}

\noindent where a superscript of minus denotes \textit{a priori} and plus
denotes \textit{a posteriori} estimate. Combining equation
(\ref{eq:luenberger1}) and equation (\ref{eq:luenberger2}) gives

\begin{equation} \label{eq:luenberger}
  \hat{\mtx{x}}_{k+1}^+ = \mtx{A}\hat{\mtx{x}}_k^- + \mtx{B}\mtx{u}_k + \mtx{L}
    (\mtx{y}_k - \mtx{C}\hat{\mtx{x}}_k^-)
\end{equation}

The following is a Kalman filter that considers the current update step and the
next predict step together rather than the current predict step and current
update step.

\begin{align}
  \text{Update step} \nonumber \\
  \mtx{K}_k &= \mtx{P}_k^- \mtx{H}^T (\mtx{H}\mtx{P}_k^- \mtx{H}^T +
    \mtx{R})^{-1} \\
  \hat{\mtx{x}}_k^+ &= \hat{\mtx{x}}_k^- + \mtx{K}_k(\mtx{y}_k -
    \mtx{H}\hat{\mtx{x}}_k^-) \label{eq:post2_x} \\
  \mtx{P}_k^+ &= (\mtx{I} - \mtx{K}_k\mtx{H})\mtx{P}_k^- \\
  \text{Predict step} \nonumber \\
  \hat{\mtx{x}}_{k+1}^+ &= \mtx{A}\hat{\mtx{x}}_k^+ + \mtx{B}\mtx{u}_k
    \label{eq:pre2_x} \\
  \mtx{P}_{k+1}^- &= \mtx{A} \mtx{P}_k^+ \mtx{A}^T +
    \mtx{\Gamma}\mtx{Q}\mtx{\Gamma}^T
\end{align}

\noindent Substitute equation (\ref{eq:post2_x}) into equation
(\ref{eq:pre2_x}).

\begin{align*}
  \hat{\mtx{x}}_{k+1}^+ &= \mtx{A}(\hat{\mtx{x}}_k^- + \mtx{K}_k(\mtx{y}_k -
    \mtx{H}\hat{\mtx{x}}_k^-)) + \mtx{B}\mtx{u}_k \\
  \hat{\mtx{x}}_{k+1}^+ &= \mtx{A}\mtx{x}_k^- + \mtx{A}\mtx{K}_k(\mtx{y}_k -
    \mtx{H}\hat{\mtx{x}}_k^-) + \mtx{B}\mtx{u}_k \\
  \hat{\mtx{x}}_{k+1}^+ &= \mtx{A}\hat{\mtx{x}}_k^- + \mtx{B}\mtx{u}_k +
    \mtx{A}\mtx{K}_k(\mtx{y}_k - \mtx{H}\hat{\mtx{x}}_k^-)
\end{align*}

\noindent Let $\mtx{C} = \mtx{H}$ and $\mtx{L} = \mtx{A} \mtx{K}_k$.

\begin{equation} \label{eq:app_kalman_leunberger}
  \hat{\mtx{x}}_{k+1}^+ = \mtx{A}\hat{\mtx{x}}_k^- + \mtx{B}\mtx{u}_k + \mtx{L}
    (\mtx{y}_k - \mtx{C}\hat{\mtx{x}}_k^-)
\end{equation}

\noindent which matches equation (\ref{eq:luenberger}). Therefore, the
eigenvalues of the Kalman filter observer can be obtained by

\begin{align}
  &eig(\mtx{A} - \mtx{L}\mtx{C}) \nonumber \\
  &eig(\mtx{A} - (\mtx{A}\mtx{K}_k)(\mtx{H})) \nonumber \\
  &eig(\mtx{A}(\mtx{I} - \mtx{K}_k\mtx{H}))
\end{align}

\subsection{Luenberger observer with separate prediction and update}
\label{subsec:app-luenberger-separate}

To run a Luenberger observer with separate prediction and update steps,
substitute the relationship between the Luenberger observer and Kalman filter
matrices derived above into the Kalman filter equations. \\

Appendix \ref{subsec:app-kalman-luenberger} shows that $\mtx{C} = \mtx{H}$ and
$\mtx{L} = \mtx{A}\mtx{K}_k$. Since $\mtx{L}$ and $\mtx{A}$ are constant, one
must assume $\mtx{K}_k$ has reached steady-state. Then,
$\mtx{K} = \mtx{A}^{-1}\mtx{L}$. Substitute this and $\mtx{C} = \mtx{H}$ into
the Kalman filter update equation.

\begin{align*}
  \hat{\mtx{x}}_{k+1}^+ &= \hat{\mtx{x}}_{k+1}^- + \mtx{K}(\mtx{y}_{k+1} -
    \mtx{H}\hat{\mtx{x}}_{k+1}^-) \\
  \hat{\mtx{x}}_{k+1}^+ &= \hat{\mtx{x}}_{k+1}^- + \mtx{A}^{-1}\mtx{L}
    (\mtx{y}_{k+1} - \mtx{C}\hat{\mtx{x}}_{k+1}^-)
\end{align*}

\noindent Substitute in equation (\ref{eq:z_obsv_y}).

\begin{equation*}
  \hat{\mtx{x}}_{k+1}^+ = \hat{\mtx{x}}_{k+1}^- + \mtx{A}^{-1}\mtx{L}
    (\mtx{y}_{k+1} - \hat{\mtx{y}}_{k+1})
\end{equation*}

The predict step is the same as the Kalman filter's. Therefore, a Luenberger
observer run with prediction and update steps is written as follows.

\begin{align}
  \text{Predict step} \nonumber \\
  \hat{\mtx{x}}_{k+1}^- &= \mtx{A}\hat{\mtx{x}}_k^- + \mtx{B}\mtx{u}_k \\
  \text{Update step} \nonumber \\
  \hat{\mtx{x}}_{k+1}^+ &= \hat{\mtx{x}}_{k+1}^- + \mtx{A}^{-1}\mtx{L}
    (\mtx{y}_{k+1} - \hat{\mtx{y}}_{k+1}) \\
  \hat{\mtx{y}}_{k+1} &= \mtx{C} \hat{\mtx{x}}_{k+1}^-
\end{align}
