\subsection{Elevator}

\subsubsection{Equations of motion}

This elevator consists of a DC brushed motor attached to a pulley that drives a
mass up or down.

\begin{figure}[H]
  \centering

  \begin{tikzpicture}[auto, >=latex', circuit ee IEC,
                      set resistor graphic=var resistor IEC graphic]
    % \draw [help lines] (-1,-3) grid (7,4);

    % Electrical equivalent circuit
    \draw (0,2) to [voltage source={direction info'={->}, info'=$V$}] (0,0);
    \draw (0,2) to [current direction={info=$I$}] (0,3);
    \draw (0,3) -- (0.5,3);
    \draw (0.5,3) to [resistor={info={$R$}}] (2,3);

    \draw (2,3) -- (2.5,3);
    \draw (2.5,3) to [voltage source={direction info'={->}, info'=$V_{emf}$}]
      (2.5,0);
    \draw (0,0) -- (2.5,0);

    % Motor
    \draw[fill=black] (2.4,1.05) rectangle (2.6,1.95);
    \draw[fill=white] (2.5,1.5) ellipse (0.3 and 0.3);

    % Transmission gear one
    \draw[fill=black!50] (3.95,1.5) ellipse (0.08 and 0.33);
    \draw[fill=black!50, color=black!50] (3.75,1.17) rectangle (3.95,1.83);
    \draw[fill=white] (3.75,1.5) ellipse (0.08 and 0.33);
    \draw (3.75,1.83) -- (3.95,1.83);
    \draw (3.75,1.17) -- (3.95,1.17);

    % Output shaft of motor
    \draw[fill=black!50] (2.8,1.45) rectangle (3.75,1.55);

    % Angular velocity arrow of drive -> transmission
    \draw[line width=0.7pt,<-] (3.2,1) arc (-30:30:1) node[above] {$\omega_m$};

    % Transmission gear two
    \draw[fill=black!50] (3.95,2.51) ellipse (0.13 and 0.67);
    \draw[fill=black!50, color=black!50] (3.75,1.83) rectangle (3.95,3.18);
    \draw[fill=white] (3.75,2.51) ellipse (0.13 and 0.67);
    \draw (3.75,3.18) -- (3.95,3.18);
    \draw (3.75,1.83) -- (3.95,1.83);

    % Pulley rear chain
    \draw[fill=black!70, color=black!70] (5.04,2.49) rectangle (5.12,0.32);
    \draw (5.03,2.49) -- (5.03,0.32);
    \draw (5.13,2.49) -- (5.13,0.32);

    % Upper pulley
    \draw[fill=black!50] (5.25,2.49) ellipse (0.13 and 0.4);
    \draw[fill=black!70] (5.2,2.49) ellipse (0.13 and 0.4);
    \draw[fill=black!50, color=black!50] (5.05,2.89) rectangle (5.15,2.09);
    \draw[fill=black!70, color=black!70] (5.15,2.89) rectangle (5.2,2.09);
    \draw[fill=black!50] (5.1,2.49) ellipse (0.13 and 0.4);
    \draw[fill=black!50, color=black!50] (5.05,2.89) rectangle (5.1,2.09);
    \draw[fill=white] (5.05,2.49) ellipse (0.13 and 0.4);
    \draw (5.05,2.09) -- (5.25,2.09);
    \draw (5.05,2.89) -- (5.25,2.89);

    % Lower pulley
    \draw[fill=black!50] (5.25,0.35) ellipse (0.13 and 0.4);
    \draw[fill=black!70] (5.2,0.35) ellipse (0.13 and 0.4);
    \draw[fill=black!50, color=black!50] (5.05,-0.05) rectangle (5.15,0.75);
    \draw[fill=black!70, color=black!70] (5.15,-0.05) rectangle (5.2,0.75);
    \draw[fill=black!50] (5.1,0.35) ellipse (0.13 and 0.4);
    \draw[fill=black!50, color=black!50] (5.05,-0.05) rectangle (5.1,0.75);
    \draw[fill=white] (5.05,0.35) ellipse (0.13 and 0.4);
    \draw (5.05,0.75) -- (5.25,0.75);
    \draw (5.05,-0.05) -- (5.25,-0.05);

    % Transmission shaft from gear two to pulley
    \draw[fill=black!50] (4.09,2.42) rectangle (5.05,2.52);

    % Angular velocity arrow between transmission and pulley
    \draw[line width=0.7pt,->] (4.54,1.97) arc (-30:30:1) node[above]
      {$\omega_p$};

    % Pulley front chain
    \draw[fill=black!70, color=black!70] (5.24,2.49) rectangle (5.32,0.32);
    \draw (5.23,2.49) -- (5.23,0.32);
    \draw (5.33,2.49) -- (5.33,0.32);

    % Pulley radius arrow
    \draw[line width=0.7pt,<->] (5.54,2.49) -- node[right] {$r$} (5.54,2.89);

    % Mass
    \fill[fill=white] (4.89,1.62) -- (4.89,1.02) -- (5.09,0.82) -- (5.09,1.02)
      -- (5.87,1.02) -- (5.67,1.62) -- cycle;
    \draw (4.89,1.62) -- (5.67,1.62);
    \draw (4.89,1.62) -- (4.89,1.02);
    \draw (4.89,1.02) -- (5.09,0.82);
    \draw (4.89,1.62) -- (5.09,1.42);
    \draw (5.67,1.62) -- (5.87,1.42);
    \draw[fill=white] (5.09,1.42) rectangle (5.87,0.82);

    % Mass velocity arrow
    \draw[line width=0.7pt,<-] (6.04,1.35) -- node {$v_m$} (6.04,0.95);

    % Descriptions inside graphic
    \draw (3.85,0.9) node {$G$};
    \draw (5.48,1.12) node {$m$};

    % Descriptions of subsystems under graphic
    \draw[decorate,decoration={brace,amplitude=10pt}]
      (3,-0.28) -- (-0.5,-0.28) node[midway,yshift=-20pt] {circuit};
    \draw[decorate,decoration={brace,amplitude=10pt}]
      (6.55,-0.28) -- (3.25,-0.28) node[midway,yshift=-20pt] {mechanics};
  \end{tikzpicture}

  \caption{Elevator system diagram}
  \label{fig:elevator}
\end{figure}

Gear ratios are written as output over input, so $G$ is greater than one in
figure \ref{fig:elevator}. \\

Based on figure \ref{fig:elevator}

\begin{equation}
  \tau_m G = \tau_p \label{eq:elevator_tau_m_ratio}
\end{equation}

where $G$ is the gear ratio between the motor and the pulley and $\tau_p$ is the
torque produced by the pulley.

\begin{equation}
  rF_m = \tau_p \label{eq:elevator_torque_pulley}
\end{equation}

where $r$ is the radius of the pulley. Substitute equation
(\ref{eq:elevator_tau_m_ratio}) into equation (\ref{eq:motor_tau_V}).

\begin{align*}
  V &= \frac{\frac{\tau_p}{G}}{K_t} R + \frac{\omega_m}{K_v} \\
  V &= \frac{\tau_p}{GK_t} R + \frac{\omega_m}{K_v}
\end{align*}

Substitute in equation (\ref{eq:elevator_torque_pulley}).

\begin{equation}
  V = \frac{rF_m}{GK_t} R + \frac{\omega_m}{K_v} \label{eq:elevator_Vinter1}
\end{equation}

The angular velocity of the motor armature $\omega_m$ is

\begin{equation}
  \omega_m = G \omega_p \label{eq:elevator_omega_m_ratio} \\
\end{equation}

where $\omega_p$ is the angular velocity of the pulley. The velocity of the mass
(the elevator carriage) is

\begin{equation*}
  v_m = r \omega_p
\end{equation*}

\begin{equation}
  \omega_p = \frac{v_m}{r} \label{eq:elevator_omega_p}
\end{equation}

Substitute equation (\ref{eq:elevator_omega_p}) into equation
(\ref{eq:elevator_omega_m_ratio}).

\begin{equation}
  \omega_m = G \frac{v_m}{r} \label{eq:elevator_omega_m}
\end{equation}

Substitute equation (\ref{eq:elevator_omega_m}) into equation
(\ref{eq:elevator_Vinter1}).

\begin{align*}
  V &= \frac{rF_m}{GK_t} R + \frac{G \frac{v_m}{R}}{K_v} \\
  V &= \frac{RrF_m}{GK_t} + \frac{G}{RK_v} v_m
\end{align*}

Solve for $F_m$.

\begin{align}
  \frac{RrF_m}{GK_t} &= V - \frac{G}{RK_v} v_m \nonumber \\
  F_m &= \left(V - \frac{G}{RK_v} v_m\right) \frac{GK_t}{Rr} \nonumber \\
  F_m &= \frac{GK_t}{Rr} V - \frac{G^2K_t}{R^2 rK_v} v_m \label{eq:elevator_F_m}
\end{align}

\begin{equation}
  \sum F = ma_m \label{eq:elevator_F_ma}
\end{equation}

where $\sum F$ is the sum of forces applied to the elevator carriage, $m$ is
the mass of the elevator carriage in kilograms, and $a_m$ is the acceleration of
the elevator carriage.

\begin{equation*}
  ma_m = F_m
\end{equation*}

Note that gravity is not part of the modeled dynamics because it complicates the
state-space \gls{model} and the controller will behave well enough without it.

\begin{align}
  ma_m &= \left(\frac{GK_t}{Rr} V - \frac{G^2K_t}{R^2 rK_v} v_m\right)
    \nonumber \\
  a_m &= \frac{GK_t}{Rrm} V - \frac{G^2K_t}{R^2 rmK_v} v_m
    \label{eq:elevator_accel}
\end{align}

\subsubsection{Continuous state-space model}

The position and velocity of the elevator can be written as

\begin{align}
  \dot{x}_m &= v_m \label{eq:elevator_cont_ss_pos} \\
  \dot{v}_m &= a_m \label{eq:elevator_cont_ss_vel}
\end{align}

where by equation (\ref{eq:elevator_accel})

\begin{equation*}
  a_m = \frac{GK_t}{Rrm} V - \frac{G^2 K_t}{R^2 rm K_v} v_m
\end{equation*}

Substitute this into equation (\ref{eq:elevator_cont_ss_vel}).

\begin{align}
  \dot{v}_m &= \frac{GK_t}{Rrm} V - \frac{G^2 K_t}{R^2 rm K_v} v_m \nonumber \\
  \dot{v}_m &= -\frac{G^2 K_t}{R^2 rm K_v} v_m + \frac{GK_t}{Rrm} V
\end{align}

\begin{align*}
  \dot{\mtx{x}} &= \mtx{A} \mtx{x} + \mtx{B} \mtx{u} \\
  \dot{\mtx{y}} &= \mtx{C} \mtx{x} + \mtx{D} \mtx{u}
\end{align*}

\begin{align*}
  \mtx{x} &= \left[
  \begin{array}{c}
    x \\
    v_m
  \end{array}
  \right] \\
  \mtx{y} &= x \\
  \mtx{u} &= V
\end{align*}

\begin{align}
  \dot{\mtx{x}} &= \left[
  \begin{array}{cc}
    0 & 1 \\
    0 & -\frac{K_t G^2}{R^2rmK_v}
  \end{array}
  \right] \left[
  \begin{array}{c}
    x \\
    v_m \\
  \end{array}
  \right] + \left[
  \begin{array}{c}
    0 \\
    \frac{GK_t}{Rrm}
  \end{array}
  \right] V \\
  \mtx{y} &= \left[
  \begin{array}{cc}
    1 & 0
  \end{array}
  \right] \left[
  \begin{array}{c}
    x \\
    v_m \\
  \end{array}
  \right] + \mtx{0} \cdot V
\end{align}

\subsubsection{Discrete state-space model}

The position and velocity of the elevator can be written as

\begin{align}
  x_{m,k+1} &= x_{m,k} + v_{m,k} \Delta t \label{eq:elevator_disc_ss_pos} \\
  v_{m,k+1} &= v_{m,k} + a_{m,k} \Delta t \label{eq:elevator_disc_ss_vel}
\end{align}

where by equation (\ref{eq:elevator_accel})

\begin{equation*}
  a_{m,k} = \frac{GK_t}{Rrm} V_k - \frac{G^2 K_t}{R^2 rm K_v} v_{m,k}
\end{equation*}

Substitute this into equation (\ref{eq:elevator_disc_ss_vel}).

\begin{align}
  v_{m,k+1} &= v_{m,k} + \left(\frac{GK_t}{Rrm} V_k -
    \frac{G^2 K_t}{R^2 rm K_v} v_{m,k}\right) \Delta t \nonumber \\
  v_{m,k+1} &= v_{m,k} + \frac{GK_t}{Rrm} \Delta t V_k -
    \frac{G^2 K_t}{R^2 rm K_v} \Delta t v_{m,k} \nonumber \\
  v_{m,k+1} &= v_{m,k} - \frac{G^2 K_t}{R^2 rm K_v} \Delta t v_{m,k} +
    \frac{GK_t}{Rrm} \Delta t V_k \nonumber \\
  v_{m,k+1} &= \left(1 - \frac{G^2 K_t}{R^2 rm K_v} \Delta t\right) v_{m,k} +
    \frac{GK_t}{Rrm} \Delta t V_k
\end{align}

\begin{align*}
  \mtx{x}_{k+1} &= \mtx{A} \mtx{x}_k + \mtx{B} \mtx{u}_k \\
  \mtx{y}_k &= \mtx{C} \mtx{x}_k + \mtx{D} \mtx{u}_k
\end{align*}

\begin{align*}
  \mtx{x}_k &= \left[
  \begin{array}{c}
    x_k \\
    v_{m,k}
  \end{array}
  \right] \\
  \mtx{y}_k &= x_k \\
  \mtx{u}_k &= V_k
\end{align*}

\begin{align}
  \mtx{x}_{k+1} &= \left[
  \begin{array}{cc}
    1 & \Delta t \\
    0 & 1 - \frac{K_t G^2}{R^2rmK_v} \Delta t
  \end{array}
  \right] \left[
  \begin{array}{c}
    x_k \\
    v_{m,k} \\
  \end{array}
  \right] + \left[
  \begin{array}{c}
    0 \\
    \frac{GK_t}{Rrm} \Delta t
  \end{array}
  \right] V_k \\
  \mtx{y}_k &= \left[
  \begin{array}{cc}
    1 & 0
  \end{array}
  \right] \left[
  \begin{array}{c}
    x_k \\
    v_{m,k} \\
  \end{array}
  \right] + \mtx{0} \cdot V_k
\end{align}
